-- -------------------------------------------------------------
-- 
-- File Name: hdl_prj\hdlsrc\ANN\Subsystem_Reference1.vhd
-- Created: 2022-05-21 11:54:13
-- 
-- Generated by MATLAB 9.11 and HDL Coder 3.19
-- 
-- -------------------------------------------------------------


-- -------------------------------------------------------------
-- 
-- Module: Subsystem_Reference1
-- Source Path: ANN/HDL_ANN/Train/Subsystem Reference1
-- Hierarchy Level: 2
-- 
-- -------------------------------------------------------------
LIBRARY IEEE;
USE IEEE.std_logic_1164.ALL;
USE IEEE.numeric_std.ALL;
USE work.HDL_ANN_pkg.ALL;

ENTITY Subsystem_Reference1 IS
  PORT( w                                 :   IN    matrix_of_std_logic_vector18(0 TO 3, 0 TO 1);  -- sfix18_En12 [4x2]
        a                                 :   IN    vector_of_std_logic_vector18(0 TO 1);  -- sfix18_En12 [2]
        e                                 :   IN    vector_of_std_logic_vector91(0 TO 3);  -- sfix91_En60 [4]
        b                                 :   IN    vector_of_std_logic_vector18(0 TO 3);  -- sfix18_En12 [4]
        alpha                             :   IN    std_logic_vector(17 DOWNTO 0);  -- ufix18_En18
        b_1                               :   OUT   vector_of_std_logic_vector110(0 TO 3);  -- sfix110_En78 [4]
        w_1                               :   OUT   matrix_of_std_logic_vector128(0 TO 3, 0 TO 1)  -- sfix128_En90 [4x2]
        );
END Subsystem_Reference1;


ARCHITECTURE rtl OF Subsystem_Reference1 IS

  -- Signals
  SIGNAL b_signed                         : vector_of_signed18(0 TO 3);  -- sfix18_En12 [4]
  SIGNAL e_signed                         : vector_of_signed91(0 TO 3);  -- sfix91_En60 [4]
  SIGNAL alpha_unsigned                   : unsigned(17 DOWNTO 0);  -- ufix18_En18
  SIGNAL Product1_cast                    : vector_of_signed19(0 TO 3);  -- sfix19_En18 [4]
  SIGNAL Product1_mul_temp                : vector_of_signed110(0 TO 3);  -- sfix110_En78 [4]
  SIGNAL Product1_out1                    : vector_of_signed109(0 TO 3);  -- sfix109_En78 [4]
  SIGNAL Subtract1_sub_cast               : vector_of_signed110(0 TO 3);  -- sfix110_En78 [4]
  SIGNAL Subtract1_sub_cast_1             : vector_of_signed110(0 TO 3);  -- sfix110_En78 [4]
  SIGNAL Subtract1_out1                   : vector_of_signed110(0 TO 3);  -- sfix110_En78 [4]
  SIGNAL w_signed                         : matrix_of_signed18(0 TO 3, 0 TO 1);  -- sfix18_En12 [4x2]
  SIGNAL c11_w                            : vector_of_signed18(0 TO 7);  -- sfix18_En12 [8]
  SIGNAL a_signed                         : vector_of_signed18(0 TO 1);  -- sfix18_En12 [2]
  SIGNAL Transpose_out1                   : vector_of_signed18(0 TO 1);  -- sfix18_En12 [2]
  SIGNAL selector_out                     : vector_of_std_logic_vector91(0 TO 7);  -- ufix91 [8]
  SIGNAL selector_out_1                   : vector_of_signed91(0 TO 7);  -- sfix91_En60 [8]
  SIGNAL s                                : vector_of_signed91(0 TO 7);  -- sfix91_En60 [8]
  SIGNAL selector_out_2                   : vector_of_signed18(0 TO 7);  -- sfix18_En12 [8]
  SIGNAL s_1                              : vector_of_signed18(0 TO 7);  -- sfix18_En12 [8]
  SIGNAL MMul_dot_product_out             : vector_of_signed109(0 TO 7);  -- sfix109_En72 [8]
  SIGNAL Product_cast                     : vector_of_signed19(0 TO 7);  -- sfix19_En18 [8]
  SIGNAL Product_mul_temp                 : vector_of_signed128(0 TO 7);  -- sfix128_En90 [8]
  SIGNAL c7_Product_out1                  : vector_of_signed127(0 TO 7);  -- sfix127_En90 [8]
  SIGNAL Subtract_sub_cast                : vector_of_signed128(0 TO 7);  -- sfix128_En90 [8]
  SIGNAL Subtract_sub_cast_1              : vector_of_signed128(0 TO 7);  -- sfix128_En90 [8]
  SIGNAL c11_Subtract_out1                : vector_of_signed128(0 TO 7);  -- sfix128_En90 [8]
  SIGNAL Subtract_out1                    : matrix_of_signed128(0 TO 3, 0 TO 1);  -- sfix128_En90 [4x2]

BEGIN
  outputgen8: FOR k IN 0 TO 3 GENERATE
    b_signed(k) <= signed(b(k));
  END GENERATE;

  outputgen7: FOR k IN 0 TO 3 GENERATE
    e_signed(k) <= signed(e(k));
  END GENERATE;

  alpha_unsigned <= unsigned(alpha);


  Product1_out1_gen: FOR t_0 IN 0 TO 3 GENERATE
    Product1_cast(t_0) <= signed(resize(alpha_unsigned, 19));
    Product1_mul_temp(t_0) <= e_signed(t_0) * Product1_cast(t_0);
    Product1_out1(t_0) <= Product1_mul_temp(t_0)(108 DOWNTO 0);
  END GENERATE Product1_out1_gen;



  Subtract1_out1_gen: FOR t_01 IN 0 TO 3 GENERATE
    Subtract1_sub_cast(t_01) <= resize(b_signed(t_01) & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0', 110);
    Subtract1_sub_cast_1(t_01) <= resize(Product1_out1(t_01), 110);
    Subtract1_out1(t_01) <= Subtract1_sub_cast(t_01) - Subtract1_sub_cast_1(t_01);
  END GENERATE Subtract1_out1_gen;


  outputgen6: FOR k IN 0 TO 3 GENERATE
    b_1(k) <= std_logic_vector(Subtract1_out1(k));
  END GENERATE;

  outputgen4: FOR k IN 0 TO 3 GENERATE
    outputgen5: FOR k1 IN 0 TO 1 GENERATE
      w_signed(k, k1) <= signed(w(k, k1));
    END GENERATE;
  END GENERATE;

  c11_wGEN_LABEL1: FOR d1 IN 0 TO 1 GENERATE
    c11_wGEN_LABEL: FOR d0 IN 0 TO 3 GENERATE
      c11_w(d0 + (d1 * 4)) <= w_signed(d0, d1);
    END GENERATE;
  END GENERATE;

  outputgen3: FOR k IN 0 TO 1 GENERATE
    a_signed(k) <= signed(a(k));
  END GENERATE;

  Transpose_out1 <= a_signed;

  selector_out(0) <= e(0);
  selector_out(1) <= e(1);
  selector_out(2) <= e(2);
  selector_out(3) <= e(3);
  selector_out(4) <= e(0);
  selector_out(5) <= e(1);
  selector_out(6) <= e(2);
  selector_out(7) <= e(3);

  outputgen2: FOR k IN 0 TO 7 GENERATE
    selector_out_1(k) <= signed(selector_out(k));
  END GENERATE;

  sGEN_LABEL: FOR d0 IN 0 TO 7 GENERATE
    s(d0) <= selector_out_1(d0);
  END GENERATE;

  selector_out_2(0) <= Transpose_out1(0);
  selector_out_2(1) <= Transpose_out1(0);
  selector_out_2(2) <= Transpose_out1(0);
  selector_out_2(3) <= Transpose_out1(0);
  selector_out_2(4) <= Transpose_out1(1);
  selector_out_2(5) <= Transpose_out1(1);
  selector_out_2(6) <= Transpose_out1(1);
  selector_out_2(7) <= Transpose_out1(1);

  s_1GEN_LABEL: FOR d0 IN 0 TO 7 GENERATE
    s_1(d0) <= selector_out_2(d0);
  END GENERATE;


  MMul_dot_product_out_gen: FOR t_02 IN 0 TO 7 GENERATE
    MMul_dot_product_out(t_02) <= s(t_02) * s_1(t_02);
  END GENERATE MMul_dot_product_out_gen;



  c7_Product_out1_gen: FOR t_03 IN 0 TO 7 GENERATE
    Product_cast(t_03) <= signed(resize(alpha_unsigned, 19));
    Product_mul_temp(t_03) <= Product_cast(t_03) * MMul_dot_product_out(t_03);
    c7_Product_out1(t_03) <= Product_mul_temp(t_03)(126 DOWNTO 0);
  END GENERATE c7_Product_out1_gen;



  c11_Subtract_out1_gen: FOR t_04 IN 0 TO 7 GENERATE
    Subtract_sub_cast(t_04) <= resize(c11_w(t_04) & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0', 128);
    Subtract_sub_cast_1(t_04) <= resize(c7_Product_out1(t_04), 128);
    c11_Subtract_out1(t_04) <= Subtract_sub_cast(t_04) - Subtract_sub_cast_1(t_04);
  END GENERATE c11_Subtract_out1_gen;


  Subtract_out1GEN_LABEL1: FOR d1 IN 0 TO 1 GENERATE
    Subtract_out1GEN_LABEL: FOR d0 IN 0 TO 3 GENERATE
      Subtract_out1(d0, d1) <= c11_Subtract_out1(d0 + (d1 * 4));
    END GENERATE;
  END GENERATE;

  outputgen: FOR k IN 0 TO 3 GENERATE
    outputgen1: FOR k1 IN 0 TO 1 GENERATE
      w_1(k, k1) <= std_logic_vector(Subtract_out1(k, k1));
    END GENERATE;
  END GENERATE;

END rtl;

